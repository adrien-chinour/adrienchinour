---
title: "Les structures de données en PHP"
date: 2020-12-27
slug: "/les-structures-de-donnees-en-php"
tags:
  - PHP
---



<div style="text-align:center">
  <img src="migration-php8/elephpant.jpg" width="100%" height="auto" />
</div>

## Il est où l'objet ? Il est où ?

Déjà un gros problème que j'ai avec les tableaux en PHP, c'est que ce ne sont pas des objets il faut passer par des fonctions
qui ne sont pas toujours simple à utiliser. Même après plusieurs années, je n'arrive pas à me souvenir de l'ordre des paramètres
ou si le tableau est passé par référence ou par valeur.

Prenons l'exemple suivant qui va calculer la moyenne des notes dans un tableau associatif :

```php
$data = [
    ['name' => 'Jean', 'note' => 8],
    ['name' => 'Alice', 'note' => 12],
    ['name' => 'Marcel', 'note' => 3],
    ['name' => 'Bob', 'note' => 18],
    ['name' => 'Elodie', 'note' => null],
];

$notes = array_filter(array_column($data, 'note'), fn($item) => null !== $item);
$average = array_sum($notes) / count($notes);
```

> Les fonctions PHP pour manipuler les array : <a rel="noreferrer noopener" target="_blank" href="https://www.php.net/manual/fr/ref.array.php">ici</a>

Une alternative, pour les utilisateurs de Symfony est d'utiliser les Collections Doctrine (_doctrine/collections_).

```php
$collection = (new \Doctrine\Common\Collections\ArrayCollection($data))
    ->map(fn($item) => $item['note'])
    ->filter(fn($item) => null !== $item);
$average = array_sum($collection->toArray()) / $collection->count();
```

> La documentation de <a rel="noreferrer noopener" target="_blank" href="https://www.doctrine-project.org/projects/doctrine-collections/en/1.6/index.html">Doctrine Collection</a>

On ne se simplifie pas forcément la vie, c'est même plus complexe qu'en utilisant les fonctions PHP.
L'intérêt de cette librairie est de fournir une implémentation utile pour doctrine ORM dans le traitement des collections d'entités,
elle n'est donc pas faite pour remplacer les fonctions natives de PHP mais peut toujours être utile pour certaines manipulations : map, filtre, etc.

Une autre alternative bien plus intéressante pour manipuler les tableaux php est celle fourni par Lavarel : _tightenco/collect_

```php
$average = collect($data)->avg(fn($item) => $item['note']);
```

> La documentation de <a rel="noreferrer noopener" target="_blank" href="https://laravel.com/docs/8.x/collections">Laravel Collection</a>

On obtient un code lisible avec une méthode qui vient "wrapper" toute notre logique autour de notre objectif : obtenir la moyenne.
L'intérêt de cette librairie est simplement de fournir au développeur un outil plus intuitif et évoluer que les fonctions natives de PHP.

Je sais que ce cas de la moyenne semble bête mais il est cependant bien pratique,
sur un projet ou j'ai eu besoin de calculer plusieurs moyennes avec des quartiles et plein d'autres statistiques à partir d'évaluations,
j'y ai trouvé un gros avantage d'un point de vue expérience développeur.

La complexité en temps et en mémoire reste la même puisque ces librairies ne sont que des wrapper objet des fonctions PHP.

> Un article au sujet des collections Laravel par Grafikart : <a rel="noreferrer noopener" target="_blank" href="https://www.grafikart.fr/tutoriels/collection-laravel-php-1173">Les Collections Laravel</a>

Il y a surement d'autres librairies similaires, j'ai trouvé _voku/arrayy_ par exemple qui semble relativement complète. (<a rel="noreferrer noopener" target="_blank" href="https://github.com/voku/Arrayy">GitHub</a>)

## Et les autres structures de données ?

Quand on parle de tableaux en PHP on rassemble plusieurs structures de données en une.

Par exemple lorsqu'on a besoin d'une liste d'éléments on ne spécifie pas de clé ainsi PHP définira lui-même des index
avec des valeurs numérique de 0 à n-1 (n étant la taille de notre tableau).
Dans le cas ou nous spécifions des clés alphanumérique alors PHP créer une table de translation ou table de hachage de la taille de notre tableau pour retrouver plus rapidement les éléments par la suite.

Grâce à la SPL (Standard PHP Library) nous avons des structures de données supplémentaires présentées dans <a rel="noreferrer noopener" target="_blank" href="https://www.php.net/manual/fr/spl.datastructures.php">la documentation PHP</a>.

> Je vous conseille cette vidéo qui explique un peu tout ça : <a rel="noreferrer noopener" target="_blank" href="https://www.youtube.com/watch?v=tX1jbqnjrR0">Les structures de données en PHP - Frédéric BOUCHERY - AFUP Day 2020 Nantes</a>

Mais le problème majeur de la SPL est que des opérations non propre à une structure de donnée soit possible.
On se retrouve avec SplStack qui permet de faire des shift/unshift ou des push/pop.

Comme présenté dans la vidéo cité precedent nous avons aussi la possibilité d'utiliser l'extension Data Structure qui corrige les problèmes de la SPL et propose plusieurs autres structures de données.

Le problème de cette extension est qu'elle n'est pas incluse de base dans PHP il faut donc l'installer ou alors utiliser le polyfill php-ds.

Je ne vais pas expliquer en détails les structures disponibles, je vous laisse regarder <a rel="noreferrer noopener" target="_blank" href="https://www.php.net/manual/fr/book.ds.php">la documentation</a>.

D'un point de vue performance il y a un intérêt sur des gros volumes de données mais comme dans les librairies orientées objet pour la manipulation de tableau on améliore surtout l'expérience développeur.

> Un article traitant des performances <a rel="noreferrer noopener" target="_blank" href="https://medium.com/@rtheunissen/efficient-data-structures-for-php-7-9dda7af674cd">Efficient data structures for PHP 7</a>.


